<a id="Getting_Started--Component_Management"></a>
#### Component Management <i class="material-icons mdl-color-text--grey-500">extension</i>

Exception made for handling of standard events and behaviors,
a [view template](#/docs#Getting_Started--View_Templates) cannot implement a more complex UI logic.

This is where *components* are being used. In addition to all the features of
a view template, a component has a piece of *JavaScript* code associated
to it and can so control any element in its view and implement
any kind of UI functionality.

This piece of JavaScript code is the **Controller** (or *Presenter*)
of the component and it consist of a function handler with two
interface methods: **create** and **destroy**, that are obviously
called respectively at the start and the end of the component
life-cycle.

To declare a component controller the `zuix.controller(...)` method is
used. This will be described in next paragraph.

##### Loading a component

In place of `data-ui-include` attribute, to load a component, the `data-ui-load`
attribute is used. The value of this attribute is the *component identifier*.
Also a `data-ui-options` attribute may be provided as for all other options/features
already described for `data-ui-include` in [content loading](#/docs#Getting_Started--Content_Loading),
such as *lazy loading* and *data binding*.

For example, consider the following "Summary Card" component, which
shows a title, a summary text, a button to share and a button to open
the full article.

The component will consist of a view template and a controller.

<small><strong>EXAMPLE</strong> Declaration of view template for the component `site/components/summary_card`</small>
<pre data-line="3,5,10,14"><code class="language-html">
<div data-ui-view="site/components/summary_card" class="mdl-card mdl-shadow--2dp">
    <div class="mdl-card__title">
        <h2 data-ui-field="title" class="mdl-card__title-text">Title</h2>
    </div>
    <div data-ui-field="summary" class="mdl-card__supporting-text">
        Lorem ipsum dolor sit amet, consectetur adipiscing elit.
        Mauris sagittis pellentesque lacus eleifend lacinia...
    </div>
    <div class="mdl-card__actions">
        <a data-ui-field="button-share" class="mdl-button mdl-js-button mdl-js-ripple-effect">
            <i class="material-icons">share</i>
            Share
        </a>
        <a data-ui-field="button-read" class="mdl-button mdl-js-button mdl-js-ripple-effect">
            <i class="material-icons">open_in_new</i>
            Read
        </a>
    </div>
</div>
</code></pre>

<small><strong>PREVIEW</strong> Preview of view template `site/components/summary_card`</small>
<div data-ui-view="site/components/summary_card" class="mdl-card mdl-shadow--2dp">
<div class="mdl-card__title">
<h2 data-ui-field="title" class="mdl-card__title-text">Title</h2>
</div>
<div data-ui-field="summary" layout="column spread-stretch" class="mdl-card__supporting-text">
Lorem ipsum dolor sit amet, consectetur adipiscing elit.
Mauris sagittis pellentesque lacus eleifend lacinia...
</div>
<div class="mdl-card__actions" align="right">
<a data-ui-field="button-share" class="mdl-button mdl-js-button mdl-js-ripple-effect">
    <i class="material-icons">share</i>
    Share
</a>
<a data-ui-field="button-read" class="mdl-button mdl-js-button mdl-js-ripple-effect">
    <i class="material-icons">open_in_new</i>
    Read
</a>
</div>
</div>
<style>
    .mdl-card[data-ui-view="site/components/summary_card"]
    { width: 300px; }
    [data-ui-view="site/components/summary_card"]
    .mdl-card__title {
        font-size: 24px;
        color: black;
        height: 96px;
        background: #C8E6C9 center / cover;
    }
    [data-ui-view="site/components/summary_card"]
    .mdl-card__title h2 {
        font-weight: 700;
        -webkit-text-stroke: 1pt rgba(255,255,255,0.6);
    }
    [data-ui-view="site/components/summary_card"]
    .mdl-card__supporting-text {
        width: 100%;
    }
    [data-ui-view="site/components/summary_card"]
    .mdl-card__supporting-text {
        height: 108px;
        overflow-y: auto;
    }
    [data-ui-view="site/components/summary_card"]
    .mdl-card__menu {
        color: #fff;
    }
</style>
<script>
zuix.controller(function(cp) {

    cp.create = function() {
        cp.field('button-read').on('click', 'item:read');
        cp.field('button-share').on('click', 'item:share');
    };

}).for('site/components/summary_card');
</script>

<p>&nbsp;</p>

The view template declaration can be either placed in the same document (in-line) or
in files (`site/components/summary_card.html` - `site/components/summary_card.css`),
in which case the `data-ui-view` attribute can be omitted.

<small><strong>EXAMPLE</strong> Controller for the component `site/components/summary_card`</small>
<pre><code>
zuix.controller(function(cp) {

    cp.create = function() {
        // UI event handlers
        cp.field('button-read').on('click', 'item:read');
        cp.field('button-share').on('click', 'item:share');
    };

}).for('site/components/summary_card');
</code></pre>

Also the controller declaration can be placed in the same document or
in its own file (`site/components/summary_card.js`),
in which case the instruction `.for('site/components/summary_card')` can be omitted.

To actually create an instance of the component, the `data-ui-load` attribute is used.

<small><strong>EXAMPLE</strong> Loading two instances of the component `site/components/summary_card`</small>
<pre data-line="2,8"><code class="language-html">
<!-- Card 1 -->
<div data-ui-load="site/components/summary_card" data-id="0"
     data-ui-options="example_card_options">
    <div data-ui-field="title">Introduction to JavaScript</div>
    <div data-ui-field="summary">This updated and expanded second edition ...</div>
</div>
<!-- Card 2 -->
<div data-ui-load="site/components/summary_card" data-id="1"
     data-ui-options="example_card_options">
    <div data-ui-field="title">Recipes 1-2-3</div>
    <div data-ui-field="summary">An ingenious repertoire of dishes that..</div>
</div>
<script>
example_card_options = {
    on: {
        'item:read': function () {
            var id = this.getAttribute('data-id');
            // TODO: open_the_content(id);
        },
        'item:share': function () {
            var id = this.getAttribute('data-id');
            // TODO: open_share_dialog(id)
        }
    },
    behavior: {
        'item:read': function () { /*...*/ },
        'item:share': function () { /*...*/ }
    }
};
</script>
</code></pre>

<small><strong>RESULT</strong></small>
<div layout="rows center-spread">

<div data-ui-load="site/components/summary_card"
 data-ui-options="example_card_1_options"
 class="example_card_1">
<div data-ui-field="title">Introduction to JavaScript</div>
<div data-ui-field="summary">This updated and expanded second edition of the 'Introduction to JavaScript' provides a user-friendly introduction to the subject.</div>
</div>

<style>
.example_card_1 .mdl-card__title {
    background: url('site/images/cover_javascript.jpg') center / cover;
}
</style>

<script>
example_card_show_delay = 0.1;
/** @type {ContextOptions} */
example_card_1_options = {
    css: false,
    on: {
        'view:create': animation_reveal,
        'item:read': function () {
            // TODO:... open the popup with content
            var card = this.children().eq(0)
                .addClass('mdl-shadow--8dp');
            this.animateCss('pulse', { duration: '0.2s' }, function () {
                    card.removeClass('mdl-shadow--8dp')
                });
            /*var i = 1, blocks = this.children().eq(0).children();
            blocks.each(function () {
                this.animateCss('pulse', { delay: ((i/15))+'s', duration: '0.15ds' });
                i++;
            });*/
        },
        'item:share': function () {
            this.animateCss('flipOutY', function () {
                //this.visibility('hidden');
                animation_reveal.call(this);
            });
        }
    }
};
function animation_reveal () {
    var card = this.children().eq(0)
        .addClass('mdl-shadow--6dp');
    this.animateCss('fadeInDown', { delay: '0.5s', duration: '0.3s' }, function () {
        card.removeClass('mdl-shadow--6dp');
    });
    var blocks = this.children().eq(0).children();
    blocks.each(function (i, item) {
        this.animateCss('bounceInDown', { delay: 0.4+(i/5)+'s', duration: '0.3s' });
    });
}
</script>

<div data-ui-load="site/components/summary_card"
  data-ui-options="example_card_1_options"
  class="example_card_2">
<div data-ui-field="title">Recipes 1-2-3</div>
<div data-ui-field="summary">An ingenious repertoire of dishes that use only three simple ingredients presents more than 250 delectable recipes.</div>
</div>

<style>
.example_card_2 .mdl-card__title {
    background: url('site/images/cover_recipes.jpg') center / cover;
}
</style>

</div>



<p>&nbsp;</p>


##### The Controller

When all elements of a component are loaded (html, css, js) the
controller method `create()` is called.
When otherwise a component is requestd to unload, the `destroy()`
method is called.

The following snippet shows the skelton of a controller declaration.

<small><strong>EXAMPLE</strong> Declaration of a generic controller for `path/to/component_name`</small>
<pre data-line="2"><code class="language-js">
// Controller of component 'path/to/component_name'
zuix.controller(function(cp) {

    cp.init = function() { /* called before component is created and before applying options */ };

    cp.create = function() { /* called after loading, when the component is created */ };

    cp.destroy = function() { /* called when the component is destroyed */ }

}).for('path/to/component_name');
</code></pre>

The `cp` object passed to the controller handler
is the controller instance itself and exposes
the following fields/methods.

###### Life-cycle handlers

- `cp.init = function() { ... }`
<br>optional *handler* function that gets called after loading and before the component is created.

- `cp.create = function() { ... }`
<br>optional *handler* function that gets called after loading, when the component is created.

- `cp.destroy = function() { ... }`
<br>*optional *handler* function called when the component is destroyed

###### Helper methods

- `cp.view([selector])`
<br/>get the component's view or if a *selector* is specified, get
the view's elements matching the *selector* criteria.
The returned value is a *ZxQuery* object. To get the underlying
DOM *Element* object, use  the *ZxQuery***.get()** method
(eg. `var el = cp.view().get();`).

- `cp.field(fieldName)`
<br/>get the view's element with matching `data-ui-field` attribute.
The returned value is a *ZxQuery* object. To get the underlying
DOM *Element* object, use  the *ZxQuery***.get()** method
(eg. <small>`var el = cp.view().get();`</small>).

- `cp.model([mode])`
<br/><em>get/set the data model object.</em>

- `cp.trigger(eventPath, eventValue)`
<br/><em>trigger a component event.</em>

- `cp.options([options])`
<br/><em>get/set the component's options.</em>

- `cp.expose(methodName, handler)`
<br/><em>expose a component's method.</em>

###### ZxQuery DOM helper class

*ZxQuery* is a built-in class of *ZUIX* that implements a very
lite subset of jQuery-like functionality. So, it can wrap elements
in a DOM and provide useful methods for manipulating it.

Some fields/parameters in *ZUIX* classes are exposed as *ZxQuery*
objects to facilitate common element's manipulation tasks.

For example the `cp.view()` method of a controller handler,
used to get the *View* element of a component,
will return a *ZxQuery* object.

To access the DOM Element behind a *ZxQuery* object the method
`.get()` is used.

```javascript
var el = cp.view().get();
console.log( el.innerHTML )
```

So the `.get()` method can be used to interoperate with
other libraries and frameworks used in a project.

For a detailed description of available methods in a *ZxQuery*
object, see the [**API**](#/api#ZUIX_API--ZxQuery) section.

<!--

##### Events and Hooks

    // TODO: ...

##### Localization

    // TODO: ...

##### App Bundling / Packaging

    // TODO: ...

#### More examples (eg. document components used in zuix site itself)

    // TODO: ...

-->